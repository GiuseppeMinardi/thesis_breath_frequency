name: Report Pipeline

# TRIGGER: Runs only when code is pushed to (or merged into) main
on:
  push:
    branches:
      - main

jobs:
  build-and-report:
    name: Type Check & Generate PDF
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          version: "latest"

      - name: Install Python with uv
        run: uv python install

      - name: Sync project environment (install deps)
        run: uv sync

      - name: Format with ruff (via uvx)
        run: uvx ruff format src/

      - name: Run ruff lint (via uvx)
        run: uvx ruff check src/

      - name: Verify PDF exists
        run: |
          if ls report/*.pdf 1> /dev/null 2>&1; then echo "PDF found"; else echo "No PDF found" && exit 1; fi

      - name: Verify billing excel exists
        run: |
          if ls *.xlsx 1> /dev/null 2>&1; then echo "Excel found"; else echo "No Excel found" && exit 1; fi
